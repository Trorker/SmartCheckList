<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üìê PDF Coordinate Viewer</title>

    <!-- BeerCSS -->
    <link href="https://cdn.jsdelivr.net/npm/beercss@3.12.11/dist/cdn/beer.min.css" rel="stylesheet">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.12.11/dist/cdn/beer.min.js"></script>
    <script type="module"
        src="https://cdn.jsdelivr.net/npm/material-dynamic-colors@1.1.2/dist/cdn/material-dynamic-colors.min.js"></script>

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        #pdf-canvas {
            cursor: crosshair;
        }

        #coords {
            margin-top: 10px;
            font-family: monospace;
            background: #eee;
            padding: 6px 12px;
            border-radius: 6px;
            transition: 0.2s;
            color: #000;
        }

        #coords.copied {
            color: green;
        }
    </style>
</head>

<body>

    <header>
        <h2>üìê PDF Coordinate Viewer</h2>
    </header>
    <main class="center-align">
        <div class="row center-align">
            <button class="chip" id="coords">x: 0, y: 0</button>
        </div>

        <article>
            <canvas id="pdf-canvas"></canvas>
        </article>
    </main>

    <!-- Footer navigazione + aggiungi foto -->
    <footer class="fixed center-align transparent">
        <nav class="toolbar secondary-container large-elevate">
            <button class="circle transparent" id="prev">
                <i>arrow_back</i>
            </button>

            <span class="max center-align" id="page-info">0/0</span>

            <button class="circle transparent" id="next">
                <i>arrow_forward</i>
            </button>

            <button class="circle">
                <i>attach_file</i>
                <input type="file" id="pdf-file" accept="application/pdf">
            </button>
        </nav>
    </footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>

        // Imposta il worker per evitare l'avviso "Deprecated API usage"
        pdfjsLib.GlobalWorkerOptions.workerSrc =
            "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";

        const fileInput = document.getElementById('pdf-file');
        const canvas = document.getElementById('pdf-canvas');
        const ctx = canvas.getContext('2d');
        const coords = document.getElementById('coords');
        const prevBtn = document.getElementById('prev');
        const nextBtn = document.getElementById('next');
        const pageInfo = document.getElementById('page-info');

        let pdf = null;
        let currentPage = 1;
        let totalPages = 0;
        let scale = 1.5;
        let viewport = null;

        // Caricamento PDF
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const arrayBuffer = await file.arrayBuffer();
            pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            totalPages = pdf.numPages;
            renderPage(currentPage);
        });

        // Renderizza la pagina specificata
        async function renderPage(num) {
            const page = await pdf.getPage(num);
            viewport = page.getViewport({ scale });
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            await page.render({ canvasContext: ctx, viewport }).promise;
            pageInfo.textContent = `Pagina ${num} / ${totalPages}`;
        }

        // Pulsanti navigazione
        prevBtn.onclick = () => {
            if (currentPage <= 1) return;
            currentPage--;
            renderPage(currentPage);
        };
        nextBtn.onclick = () => {
            if (currentPage >= totalPages) return;
            currentPage++;
            renderPage(currentPage);
        };

        // Mostra coordinate
        canvas.addEventListener('mousemove', (event) => {
            if (!viewport) return;
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const pdfX = x / scale;
            const pdfY = (canvas.height - y) / scale;
            coords.textContent = `x: ${pdfX.toFixed(1)}, y: ${pdfY.toFixed(1)}`;
            coords.classList.remove("copied");
        });

        // Copia coordinate e mostra punto cliccato
        canvas.addEventListener("click", async (event) => {
            if (!viewport) return;
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const pdfX = (x / scale).toFixed(2);
            const pdfY = ((canvas.height - y) / scale).toFixed(2);
            const coordText = `page: ${currentPage}, x: ${pdfX}, y: ${pdfY}`;
            await navigator.clipboard.writeText(coordText);

            // feedback
            coords.textContent = `üìã Copiato ‚Üí ${coordText}`;
            coords.classList.add("copied");

            // punto visivo
            ctx.beginPath();
            ctx.arc(x, y, 4, 0, Math.PI * 2);
            ctx.fillStyle = "red";
            ctx.fill();
        });
    </script>
</body>

</html>